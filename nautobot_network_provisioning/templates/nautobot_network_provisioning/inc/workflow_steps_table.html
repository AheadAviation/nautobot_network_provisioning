<style>
    .workflow-sequence {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding: 20px;
        background-color: var(--nautobot-bg-light, #f8f9fa);
        border-radius: 8px;
    }
    .workflow-step-card {
        display: flex;
        align-items: center;
        background: var(--nautobot-bg-base, #fff);
        border: 1px solid var(--nautobot-border-color, #dee2e6);
        border-left: 5px solid var(--nautobot-primary-color, #007bff);
        border-radius: 4px;
        padding: 15px;
        position: relative;
    }
    .workflow-step-card:hover {
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .step-number {
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--nautobot-text-muted, #6c757d);
        margin-right: 20px;
        min-width: 30px;
    }
    .step-content {
        flex-grow: 1;
    }
    .step-actions {
        display: flex;
        gap: 5px;
    }
    .step-connector {
        width: 2px;
        height: 15px;
        background-color: var(--nautobot-border-color, #dee2e6);
        margin-left: 20px;
    }
    body.theme-dark .workflow-step-card {
        background-color: #2d2d2d;
        border-color: #444;
    }
</style>

<div class="panel panel-default">
    <div class="panel-heading">
        <strong>Workflow Orchestration</strong>
        <div class="pull-right">
            {% if perms.nautobot_network_provisioning.add_workflowstep %}
                <a href="{% url 'plugins:nautobot_network_provisioning:workflowstep_add' %}?workflow={{ object.pk }}" class="btn btn-xs btn-primary">
                    <i class="mdi mdi-plus"></i> Add Step
                </a>
            {% endif %}
        </div>
    </div>
    <div class="panel-body">
        <div class="workflow-sequence">
            {% for step in object.steps.all %}
                <div class="workflow-step-card">
                    <div class="step-number">{{ step.order }}</div>
                    <div class="step-content">
                        <h4 class="mb-1">
                            <a href="{{ step.get_absolute_url }}">{{ step.name }}</a>
                            <small class="label label-info ml-2">{{ step.get_step_type_display }}</small>
                        </h4>
                        {% if step.task %}
                            <div>
                                <i class="mdi mdi-cube-outline"></i> Task: 
                                <a href="{{ step.task.get_absolute_url }}">{{ step.task.name }}</a>
                            </div>
                        {% endif %}
                        {% if step.condition %}
                            <div class="text-warning small mt-1">
                                <i class="mdi mdi-help-circle-outline"></i> Condition: <code>{{ step.condition }}</code>
                            </div>
                        {% endif %}
                    </div>
                    <div class="step-actions">
                        <a href="{% url 'plugins:nautobot_network_provisioning:workflowstep_edit' pk=step.pk %}" class="btn btn-xs btn-warning">
                            <i class="mdi mdi-pencil"></i> Edit
                        </a>
                    </div>
                </div>
                {% if not forloop.last %}
                    <div class="step-connector"></div>
                {% endif %}
            {% empty %}
                <div class="alert alert-info mb-0">No steps defined for this workflow yet.</div>
            {% endfor %}
        </div>
    </div>
</div>
