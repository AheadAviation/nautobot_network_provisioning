# Architecture overview

## Layers

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              ARCHITECTURE                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         UI LAYER                                       │  │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │  │
│  │  │ Portal   │ │ Workflow │ │ Task     │ │ Provider │ │ Git Sync │     │  │
│  │  │ (Forms)  │ │ Builder  │ │ Builder  │ │ Config   │ │          │     │  │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                                    ▼                                         │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                       WORKFLOW ENGINE                                  │  │
│  │  • Step sequencing          • Context management                       │  │
│  │  • Condition evaluation     • Approval handling                        │  │
│  │  • Error handling           • Retry logic                              │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                                    ▼                                         │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                       TASK EXECUTION                                   │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │  │
│  │  │ Task        │  │ Render      │  │ Provider    │                    │  │
│  │  │ Resolution  │──▶ Engine      │──▶ Execution   │                    │  │
│  │  │ (platform   │  │ (Jinja2)    │  │ (push/pull) │                    │  │
│  │  │ matching)   │  │             │  │             │                    │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                    │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                                    ▼                                         │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         DATA LAYER                                     │  │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐     │  │
│  │  │ Nautobot Core    │  │ App Models       │  │ External Systems │     │  │
│  │  │ (Device, VLAN,   │  │ (Tasks, Workflows│  │ (ServiceNow,     │     │  │
│  │  │ Interface, etc.) │  │ Executions, etc.)│  │ Git, DNAC, etc.) │     │  │
│  │  └──────────────────┘  └──────────────────┘  └──────────────────┘     │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

## The golden workflow (most customers)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         GOLDEN WORKFLOW                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐           │
│  │Submit│──▶│Render│──▶│Preview│──▶│Approve│──▶│Execute│──▶│Record│         │
│  │Form  │   │Config│   │Diff   │   │(opt)  │   │Change │   │Result│         │
│  └──────┘   └──────┘   └──────┘   └──────┘   └──────┘   └──────┘           │
│                                                                              │
│  1. User submits request via portal form                                    │
│  2. Workflow renders config from Nautobot data + inputs                     │
│  3. User previews what will change (diff view)                              │
│  4. Approver reviews and approves (if required)                             │
│  5. Provider pushes change to device/controller                             │
│  6. Execution record captures full audit trail                              │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```
